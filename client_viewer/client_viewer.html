<html>
<head>
	<link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
</head>>
<style>
    body {
        background: white }
    section {
        color: white;
        position: absolute;
        top: 50%;
        left: 50%;
        /*margin-right: 0%;*/
        transform: translate(-50%, -50%) }
        .headfoot {
        	padding-left: 15px;
        	padding-right: 15px;
        	padding-top: 30px;
        	
        	color:rgb(255, 255, 255);
        	font-family:Montserrat,"Helvetica Neue",Helvetica,Arial,sans-serif;
        }
        .headtext{
        	font-size:21px;
        	font-weight:700;
        	height:50px;
        	line-height:20px;
        }
</style>

<script type="text/javascript">
	function loadUrl(url) {
    	document.getElementById("video_frame").src=url;
	}

	function initializeIFrame() {
		// margin is used to over scrollbar
		var margin = 0;
		var width = window.innerWidth
						|| document.documentElement.clientWidth
						|| document.body.clientWidth;

		var height = window.innerHeight
						|| document.documentElement.clientHeight
						|| document.body.clientHeight;

		var frame = document.getElementById("video_frame");
		frame.height = 500;//height - margin;
		frame.width = 500;//width - margin;	

		// doesn't belong here
		//loadUrl('https://www.youtube.com/embed/e8FI120ItdU?autoplay=1');	
	}


	// emotionType should be between 0 and 3
	function onEmotionReceived(emotionType) {
		var emotionCount = document.getElementById("emotionCount");
		var emotionCountVal = parseInt(emotionCount.value);
		emotionCount.value = emotionCountVal + 1;

		var emotionList = document.getElementById("emotionSlider");
		if(emotionCount.value > 25) {
			emotionList.removeChild(emotionList.lastChild);
		}

		var emotionImage = document.createElement("i");
		emotionImage.style.height = '20px';
		emotionImage.style.width = '20px';
		if(emotionType == 0) {
			emotionImage.className = "em em---1";
			var thumbsUpCount = document.getElementById("thumbsUpCount");
			var thumbsUpCountVal = parseInt(thumbsUpCount.value);
			thumbsUpCount.value = thumbsUpCountVal + 1;
		}
		else if(emotionType == 1) {
			emotionImage.className = "em em--1";
			var thumbsDownCount = document.getElementById("thumbsDownCount");
			var thumbsDownCountVal = parseInt(thumbsDownCount.value);
			thumbsDownCount.value = thumbsDownCountVal + 1;

		}
		else if(emotionType == 2) {
			emotionImage.className = "em em-laughing";
			var laughingCount = document.getElementById("laughingCount");
			var laughingCountVal = parseInt(laughingCount.value);
			laughingCount.value = laughingCountVal + 1;

		var laughingCount = document.getElementById("laughingCount");
		}
		else if(emotionType == 3) {
			emotionImage.className = "em em-anguished";
			var anguishedCount = document.getElementById("anguishedCount");
			var anguishedCountVal = parseInt(anguishedCount.value);
			anguishedCount.value = anguishedCountVal + 1;
		}
		emotionList.insertBefore(emotionImage, emotionList.firstChild);
	}

</script>

<body onload="initializeIFrame()" style="margin:0px;background-color: rgb(24, 188, 156);">

<header style='background-color:rgb(44, 62, 80);margin:0pt;'>
<div class="headfoot headtext">
<span id="room_title">Broadcaster</span>'s feed
</div>
</header>
<article >
<div  style="background-color:rgb(44, 62, 80);border-left: 10px;border-bottom: 0px;border-top: 10px;border-right: 10px; border-style: solid;border-color: #FFFFFF">
<section>
	<iframe id="video_frame" scrolling="no" frameborder="25" style="border: 0px solid #FFFFFF"></iframe>
	<br>
	<span id="emotionSlider"></span>
</section>

<!-- These contain the number of emotions received-->
<input id="emotionCount" type="hidden" value="0">
<input id="thumbsUpCount" type="hidden" value="0">
<input id="thumbsDownCount" type="hidden" value="0">
<input id="laughingCount" type="hidden" value="0">
<input id="anguishedCount" type="hidden" value="0">

</div>
</article>
<footer style="background-color:rgb(44, 62, 80);margin:0pt;height:50pt;position:absolute;left:0;bottom:0;overflow:hidden;width:100%">
<div class="headfoot">
Live Video Jockey
</div>
</footer>
	<div id="userscount"></div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
	loadUrl("/viewer/novideofound.html");

	var socket = io();
	var urlParams = new URLSearchParams(window.location.search);
	var name = urlParams.get('room');
	var obj = {};
    obj['name'] = name;

    $('#room_title').html(name);
    
    socket.emit('register viewer', JSON.stringify(obj));
	
	socket.on('publish video', function(url){
		console.log("Video URL received = " + url);
	  	loadUrl(url);
	});

	socket.on('initial video', function(url){
		console.log("Initial Video URL received = " + url);
	  	loadUrl(url);
	});

	socket.on('update viewers', function(viewers){
		console.log("Viewers count = " + viewers);
		$("#userscount").text("Viewers count = " + viewers);
	})
</script>
</html>
	
