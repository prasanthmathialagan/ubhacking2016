<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <title>Server View</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="/js/jquery.js"></script>
     <script src="/socket.io/socket.io.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <script type="text/javascript">

    function updateYoutubeVideos(keyword){
    $.get(
    "https://www.googleapis.com/youtube/v3/search?q="+keyword+"&part=id&eventType=live&type=video&videoEmbeddable=true&videoSyndicated=true&maxResults=5&key=AIzaSyCVzkiLvCg-oK2aK-ZSiF7xJaXkeHXaAek",
    {},
    function(data) {
        var urls = [];
        var items = data["items"];
        for(i=0; i<items.length;i++){
            var id = items[i]["id"];
            urls.push("https://www.youtube.com/embed/"+id["videoId"]+"?autoplay=1");
        }
        updateRow(urls,"youtube");
    }
    );  
    }  

    function updateRow(urls, id){
        var row = document.getElementById(id);
        var rowLength = row.cells.length;
        for(var i = 0; i < rowLength; i++) {
            row.deleteCell(0);
        }

        for(var i = 0; i < urls.length; i++){
            var cell = row.insertCell(-1);
            var ifrm = createIFrameTag(urls[i],id+""+(i+1));
            cell.innerHTML = ifrm;                
        }
    }
    
    function updatePeriscopeVideos(keyword){
        updateRow(["https://www.periscope.tv/w/1BRKjAEVXQjxw"],"periscope");
    }

    function updateFacebookVideos(keyword){
        updateRow(["https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2FRTnews%2Fvideos%2F10154858714744411%2F&width=240&show_text=false&height=135&appId"],"facebook");
    }        

	function createIFrameTag(url, id){
        var ifrm = "<iframe src='"
		ifrm += url+"'";
		ifrm += 'width=320 '
		ifrm += ">URL Load</iframe>"
		var buttn = "<button type=button value='"+url+"'"
		buttn += "id="+id
		buttn += " onClick=selectVideo('"+id+"'); >Select Video</button>"
		var tab = "<table><tr><td>"
		tab += ifrm;
		tab += "</td></tr><tr><td>"
		tab += buttn
		tab += "</td></tr></table>"
		return tab;
	}

	function selectVideo(id){
        var buttn = document.getElementById(id);
		var focusIFrame = document.getElementById("userFocus");
		focusIFrame.src = buttn.value;
	}

	function publishVideo(){
		var focusIFrame = document.getElementById("userFocus");
		var publishIFrame = document.getElementById("liveVideo");
		publishIFrame.src = focusIFrame.src;

        console.log('Publishing the video URL to the server ' + publishIFrame.src);

        socket.emit('publish video', publishIFrame.src);
	}

    function updateVideos(keyword) {

        updateYoutubeVideos(keyword);
        updatePeriscopeVideos(keyword);
        updateFacebookVideos(keyword);
    }

    </script>
    

    </head>
    <body class="container">
    
    <div class="searchArea" align="center" style="margin: 20px">
    <input id="keyword" type="text">
    <button onclick="updateVideos(document.getElementById('keyword').value);">Search</button>
    </div>

    <h1 id="uname"></h1>
    <div class="table">
        <table class="table table-striped" id="table1">
        <tr id="youtube"></tr>
        <tr id="facebook"></tr>
        <tr id="periscope"></tr>
        </table>
        </div>
        <div class="table-responsive">
        <table class="table" id="table2">
        	<tr>
        		<td>
        		<iframe id="userFocus" src=""></iframe>
        		</td>
        		<td>
        		<iframe id="liveVideo" src="" ></iframe>			
        		</td>
        	</tr>
        	<tr><td>
        	<button type=button onClick="publishVideo();"> Publish Video</button>
        	</td></tr>
        </table>  
        </div>
    </body>

    <script type="text/javascript">
        var socket = io();
        var urlParams = new URLSearchParams(window.location.search);
        var name = urlParams.get('name');
        var obj = {};
        obj['name'] = name;
        obj['img'] = 'Testimage';
        socket.emit('register curator', JSON.stringify(obj));

        $('#uname').text(name);

    </script>
</html>